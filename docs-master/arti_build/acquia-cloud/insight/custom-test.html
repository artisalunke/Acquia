
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Creating custom Insight tests &#8212; Acquia Help Center</title>
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/foundation-sphinx.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../_static/what-input/what-input.min.js"></script>
    <script type="text/javascript" src="../../_static/foundation-sites/foundation.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Installing the Acquia Connector" href="install.html" />
    <link rel="prev" title="Sending information to Acquia Insight" href="config.html" /> 
  </head>
  <body>

    
<header>
<div class="topbar">
    <div class="col left">
        <a href="/" title="Acquia Help Center Home" class="logo">Acquia Help Center</a>
    </div>
    <div class="col right">
      <ul class="main-nav">
        <li>
          <a href="https://www.acquia.com" title="Go to www.acquia.com for our latest information.">Acquia.com</a>
        </li>
        <li>
            <a href="https://dev.acquia.com" title="Acquia's Developer Center: developers.acquia.com">Developers</a>
        </li>
        <li>
            <a href="https://training.acquia.com" title="Go to training.acquia.com to find out about courses and certifications.">Training</a>
        </li>
        <li>
            <a href="/site-search" data-drupal-link-system-path="site-search">Search</a>
        </li>
      </ul>
    </div>
</div>
<div class="bottombar">
    <div class="searchbar-wrapper">
        <form action="search.html" method="get" class="searchbar">
            <div class="search-title">Need help finding something? <strong>Start Here.</strong></div>
            <div class="search-box">
                <input type="search" name="q" maxlength="128" size="15" value="" class="st-default-search-input">
                <input type="hidden" name="check_keywords" value="yes">
                <input type="hidden" name="area" value="default">
            </div>
            <div class="search-btn">
                <input class="btn-search button" type="submit" id="edit-submit-acquia-search" value="Search Docs">
            </div>
        </form>
    </div>
	</div>
</header>



    
<div class="breadcrumbs-wrapper">
	<ul>
        
        <li><a href="../../index.html">Home</a></li>
        
        <li><a href="../../acquia-cloud.html" >Acquia Cloud</a></li>
        <li><a href="../insight.html" accesskey="U">Acquia Insight</a></li>
        <li class="current">Creating custom Insight tests</li>
	</ul>
</div>


<div class="row">
    
        
  <div class="small-4 large-3 columns" id="sidebar" data-sticky-container>
      <div class="sticky" data-sticky data-margin-top="0"><ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../acquia-cloud.html">Acquia Cloud</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../free.html">Getting started with Acquia Cloud Free</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloud-ui.html">Using the Acquia Cloud interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arch.html">Acquia Cloud architecture and key concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ready.html">Acquia Cloud onboarding guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create.html">Creating a new application on Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manage.html">Managing applications with Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitor.html">Monitoring your applications and infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../access.html">Controlling access to Acquia Cloud</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../insight.html">Acquia Insight</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="alerts.html">Understanding the Insight score and alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="code.html">Viewing information about Drupal modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html">Sending information to Acquia Insight</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Creating custom Insight tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="install.html">Installing the Acquia Connector</a></li>
<li class="toctree-l3"><a class="reference internal" href="prevent.html">Preventing data reporting in Acquia Insight</a></li>
<li class="toctree-l3"><a class="reference internal" href="using.html">Using Acquia Insight to optimize your application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop.html">Developing applications on Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../node-js.html">Node.js and Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../container.html">Containers in Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance.html">Improving application performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../subs.html">Managing subscriptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cd.html">Acquia Cloud CD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../glossary.html">Acquia Cloud glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../known-issues.html">Known issues in Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release-notes.html">Release notes - Acquia Cloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../self-service-scaling.html">Using a Cloud Service Management plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ssl.html">Enabling SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../teams.html">Managing users, teams, roles, and permissions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../edge.html">Acquia Cloud Edge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../shield.html">Acquia Cloud Shield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../site-factory.html">Acquia Cloud Site Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../commerce.html">Acquia Commerce Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dam.html">Acquia DAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-desktop.html">Acquia Dev Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../journey.html">Acquia Journey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lift.html">Acquia Lift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">Acquia Platform APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acquia-search.html">Acquia Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devtools.html">Developer tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lightning.html">Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">Acquia Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ra.html">Remote Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resource.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html">Acquia Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide.html">Products and Services Guide</a></li>
</ul>

      </div>
  </div>
    
    <div id="content" class="small-8 large-9 columns">
        
            
  <div class="section" id="creating-custom-insight-tests">
<h1>Creating custom Insight tests<a class="headerlink" href="#creating-custom-insight-tests" title="Permalink to this headline">¶</a></h1>
<p>Acquia Insight provides dozens of tests to check your
application’s conformance with best practices for security, performance,
and general Drupal and web application development. In addition, Insight
enables you to develop your own custom Insight tests. Your custom
Insight tests can check for aspects of your applications that are most
important to your own business needs.</p>
<p>Creating a custom Insight test requires that you write PHP code and
create and deploy a custom Drupal module. You will need to create a
custom Drupal module that implements <code class="docutils literal"><span class="pre">hook_acquia_spi_test();</span></code>, and
then install and enable it on your Drupal application.</p>
<p>Data sent in a custom Insight test is stored on Acquia’s servers in an
unencrypted database, so be careful not to send sensitive information in
any field. You can include multiple tests in each callback, provided
that each test has a unique identifier.</p>
<p>Your custom Insight test module must implement
<code class="docutils literal"><span class="pre">hook_acquia_spi_test();</span></code> in order to send test data back to Insight,
so that the test results can be reported in Insight and reflected in
your application’s Insight score. This hook must return an array that
contains the test that you want to use and the results for success or
failure. The array includes the following elements:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Array element</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">description</span></code></td>
<td>string</td>
<td>Detailed information
regarding the test,
its impact, and other
relevant details.
Cannot exceed 1024
characters.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">solved_message</span></code></td>
<td>string</td>
<td>The message to
display when the test
succeeded. Cannot
exceed 1024
characters.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">failed_message</span></code></td>
<td>string</td>
<td>The message to
display when the test
has failed. Cannot
exceed 1024
characters.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">solved</span></code></td>
<td>boolean</td>
<td>A flag indicating
whether or not the
test was successful.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fix_details</span></code></td>
<td>string</td>
<td>Information on how to
fix or resolve the
test if it failed.
Cannot exceed 1024
characters.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">category</span></code></td>
<td>string</td>
<td>The Insight alert
category within which
to place the test.
Must be either
‘performance,’
‘security,’ or
‘best_practices.’</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">severity</span></code></td>
<td>int</td>
<td>The severity level of
the custom test. Must
be either 0, 1, 2, 4,
8, 16, 32, 64, or
128. Higher
severities impact the
Insight score
proportionally.</td>
</tr>
</tbody>
</table>
<p>Here is a simple example that tests whether the user with the provided
user ID has the administrator role:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">/**</span>
<span class="x">* Check if a user has the administrator role.</span>
<span class="x">*</span>
<span class="x">* @param int $uid</span>
<span class="x">*  The UID of the user to audit.</span>
<span class="x">*</span>
<span class="x">* @return boolean</span>
<span class="x">*  TRUE if the provided user has the administrator role.</span>
<span class="x">*</span>
<span class="x">*/ function acquia_examples_admin_role_audit($uid)</span>
<span class="x"> {    $result = TRUE;    $user = user_load($uid);</span>
<span class="x"> if (!in_array(&#39;administrator&#39;, $user-&gt;roles)) {</span>
<span class="x"> $result = FALSE;   }</span>
<span class="x"> return $result; }</span>
</pre></div>
</div>
<p>In your test callback function, return an array for each test you
include. For example:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="x">/**  * Implements hook_acquia_spi_test(). Example usages of properly formatted</span>
<span class="x">* Acquia Insight custom tests.</span>
<span class="x">*</span>
<span class="x">* @see acquia_connector/acquia_spi/acquia_spi.api.php for more information.</span>
<span class="x">*</span>
<span class="x">*/ function acquia_examples_acquia_spi_test() {</span>
<span class="x"> return array(</span>
<span class="x"> // Ensure that user 1 has administrator privileges.</span>
<span class="x">  &#39;user_1_admin_privileges_check&#39; =&gt; array(</span>
<span class="x">   &#39;description&#39;    =&gt; &#39;Check if the user UID 1 has administrator privileges.&#39;,</span>
<span class="x">   &#39;solved_message&#39; =&gt; &#39;Admin User (UID 1) has administrator privileges&#39;,</span>
<span class="x">   &#39;failed_message&#39; =&gt; &#39;Admin User (UID 1) lacks administrator privileges&#39;,</span>
<span class="x">   &#39;solved&#39;         =&gt; acquia_examples_admin_role_audit(1),</span>
<span class="x">   &#39;fix_details&#39;    =&gt; &#39;Give user UID 1 administrator privileges.&#39;,</span>
<span class="x">   &#39;category&#39;       =&gt; &#39;security&#39;,</span>
<span class="x">   &#39;severity&#39;       =&gt; 32,</span>
<span class="x">      ),</span>
<span class="x">     );</span>
<span class="x">     }</span>
</pre></div>
</div>
<p>Note how the solved element tests whether, given user ID 1, the
<code class="docutils literal"><span class="pre">acquia_examples_admin_role_audit</span></code> function defined in the previous
example returns <code class="docutils literal"><span class="pre">TRUE</span></code>.</p>
<p>For more examples, <a class="reference external" href="/sites/default/files/doc/2013/sep/acquia_examples.zip">download this custom
module</a>.</p>
</div>


        
    </div>
</div>

    
<div class="row">
    <div class="small-4 large-3 columns"></div>
    <div id="relinks" class="small-8 large-9 columns">
        <div class="pagination-wrapper">
            <div class="prev">
                <a href="config.html" title="Sending information to Acquia Insight"><b>‹&nbsp;</b>Sending information to Acquia Insight</a>
            </div>
            
            <div class="next">
                <a href="install.html" title="Installing the Acquia Connector">Installing the Acquia Connector<b>&nbsp;›</b></a>
            </div>
            
        </div>
    </div>
</div>



    
<div class="assistance-wrapper">
	<div class="assistance-tbl">
		<div class="col">
			<p><img src="/_static/phone.png" alt="Contact support">Still need assistance? <strong><a href="https://docs.acquia.com/support">Contact Acquia Support</a></strong></p>
		</div>
	</div>
</div>
<div class="support">
	<div class="support-tbl">
		<div class="col left">
			<h2><a href="https://www.acquia.com/customer-success/acquia-global-support">Support</a></h2>
			<ul class="no-bullet">
				<li><a class="light-link" href="https://www.acquia.com/support">Contact Support</a></li>
			</ul>
		</div>
		<div class="col middle">
			<h2><a href="https://www.acquia.com/about-us">About Acquia</a></h2>
			<ul class="no-bullet">
				<li><a class="light-link" href="https://www.acquia.com/about-us">About Us</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/leadership">Leadership</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/board">Board of Directors</a></li>
				<li><a class="light-link" href="https://www.acquia.com/investors">Investors</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/newsroom">Newsroom</a></li>
				<li><a class="light-link" href="https://www.acquia.com/careers">Careers</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/contact">Contact Us</a></li>
			</ul>
			<ul class="social-media">
				<li>
					<a class="fa fa-twitter fa-lg ext" href="https://twitter.com/acquia" target="_blank" rel="nofollow">
						<span class="hide">Twitter</span>
					</a>
				</li>
				<li>
					<a class="fa fa-facebook fa-lg ext" href="https://www.facebook.com/acquia" target="_blank" rel="nofollow">
						<span class="hide">Facebook</span>
					</a>
				</li>
				<li>
					<a class="fa fa-github-alt fa-lg ext" href="https://github.com/acquia" target="_blank" rel="nofollow">
						<span class="hide">Github</span>
					</a>
				</li>
				<li>
					<a class="fa fa-linkedin-in fa-lg ext" href="http://www.linkedin.com/company/167056" target="_blank" rel="nofollow">
						<span class="hide">LinkedIn</span>
					</a>
				</li>
				<li>
					<a class="fa fa-google-plus-g fa-lg ext" href="https://plus.google.com/+acquia" target="_blank" rel="nofollow">
						<span class="hide">Google+</span>
					</a>
				</li>
				<li>
					<a class="fa fa-play fa-lg ext" href="https://www.youtube.com/user/AcquiaTV" target="_blank" rel="nofollow">
						<span class="hide">YouTube</span>
					</a>
				</li>
				<li>
					<a class="fa fa-envelope fa-lg" href="https://www.acquia.com/about-us/contact">
						<span class="hide">Contact Us</span>
					</a>
				</li>
			</ul>
		</div>
		<div class="col right">
			<div class="centered">
				<p>
					<img alt="Acquia: Think Ahead" src="/_static/acquia-logo-think-ahead-black-small.svg">
				</p>
				<p class="margin-left-half">
					<span>53 State Street, 10th Floor<br>
					Boston, MA 02109<br>
					United States<br>
					Phone: 888-922-7842</span><br>
					Map: <a class="decorate ext" href="http://maps.google.com/?q=42.358429+-71.056184+%2853+State+Street%2C+10th+Floor%2C+Boston%2C+MA%2C+02109%2C+us%29" target="_blank" rel="nofollow">Google Maps<span class="ext"><span class="element-invisible"> </span></span></a><br><a class="decorate" href="https://www.acquia.com/about-us/contact#block-views-locations-block-1">View other locations</a>
				</p>
			</div>
		</div>
	</div>
</div>
<div class="top-bar row column">
	<div class="footer" role="contentinfo">Copyright &copy 2018 Acquia Inc. All Rights Reserved. </br>Drupal is a registered trademark of <a href="https://dri.es/">Dries Buytaert</a>. All product names, logos, and brands are property of their respective owners.
    </div>
</div>
    </div>

    <script> $(document).foundation() </script>
    <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

      _st('install','2_Wi1aQvEeu61haxG8TX','2.0.0');
    </script>

  </body>
</html>