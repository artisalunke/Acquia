
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Patching and locking modules &#8212; Acquia Help Center</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="../_static/foundation-sphinx.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/what-input/what-input.min.js"></script>
    <script type="text/javascript" src="../_static/foundation-sites/foundation.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote Administration FAQ" href="faq.html" />
    <link rel="prev" title="Security update process" href="security-update-process.html" /> 
  </head>
  <body>

    
<header>
<div class="topbar">
    <div class="col left">
        <a href="/" title="Acquia Help Center Home" class="logo">Acquia Help Center</a>
    </div>
    <div class="col right">
      <ul class="main-nav">
        <li>
          <a href="https://www.acquia.com" title="Go to www.acquia.com for our latest information.">Acquia.com</a>
        </li>
        <li>
            <a href="https://dev.acquia.com" title="Acquia's Developer Center: developers.acquia.com">Developers</a>
        </li>
        <li>
            <a href="https://training.acquia.com" title="Go to training.acquia.com to find out about courses and certifications.">Training</a>
        </li>
        <li>
            <a href="/site-search" data-drupal-link-system-path="site-search">Search</a>
        </li>
      </ul>
    </div>
</div>
<div class="bottombar">
    <div class="searchbar-wrapper">
        <form action="search.html" method="get" class="searchbar">
            <div class="search-title">Need help finding something? <strong>Start Here.</strong></div>
            <div class="search-box">
                <input type="search" name="q" maxlength="128" size="15" value="" class="st-default-search-input">
                <input type="hidden" name="check_keywords" value="yes">
                <input type="hidden" name="area" value="default">
            </div>
            <div class="search-btn">
                <input class="btn-search button" type="submit" id="edit-submit-acquia-search" value="Search Docs">
            </div>
        </form>
    </div>
	</div>
</header>



    
<div class="breadcrumbs-wrapper">
	<ul>
        
        <li><a href="../index.html">Home</a></li>
        
        <li><a href="../ra.html" accesskey="U">Remote Administration</a></li>
        <li class="current">Patching and locking modules</li>
	</ul>
</div>


<div class="row">
    
        
  <div class="small-4 large-3 columns" id="sidebar" data-sticky-container>
      <div class="sticky" data-sticky data-margin-top="0"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../acquia-cloud.html">Acquia Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="../edge.html">Acquia Cloud Edge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shield.html">Acquia Cloud Shield</a></li>
<li class="toctree-l1"><a class="reference internal" href="../site-factory.html">Acquia Cloud Site Factory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../commerce.html">Acquia Commerce Manager</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dam.html">Acquia DAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-desktop.html">Acquia Dev Desktop</a></li>
<li class="toctree-l1"><a class="reference internal" href="../journey.html">Acquia Journey</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lift.html">Acquia Lift</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">Acquia Platform APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acquia-search.html">Acquia Search</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devtools.html">Developer tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lightning.html">Lightning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Acquia Support</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../ra.html">Remote Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="scope.html">Understanding the scope of Remote Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html">Requirements for Remote Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="preferences.html">Remote Administration preferences</a></li>
<li class="toctree-l2"><a class="reference internal" href="workflow.html">Using the recommended workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="environment.html">Remote Administration environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="request.html">Requesting work</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Implementing security updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="automation.html">Remote Administration automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="security-update-process.html">Security update process</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Patching and locking modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">Remote Administration FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resource.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Acquia Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guide.html">Products and Services Guide</a></li>
</ul>

      </div>
  </div>
    
    <div id="content" class="small-8 large-9 columns">
        
            
  <div class="section" id="patching-and-locking-modules">
<h1>Patching and locking modules<a class="headerlink" href="#patching-and-locking-modules" title="Permalink to this headline">¶</a></h1>
<p>Modification of contributed module and core files must implement one of
the following options to ensure that changes are not overwritten by
Remote Administration (RA) updates. RA uses Drush to update both core
and contributed modules, so all modifications will be overwritten during
the update process.</p>
<p>Note</p>
<p>If you’re working with a third-party development team who won’t be a
part of your ongoing support, ensure that they understand and supply the
information in these guidelines.</p>
<div class="section" id="locking-modules">
<span id="locking"></span><h2>Locking modules<a class="headerlink" href="#locking-modules" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>If modified contributed modules should not be updated even when
insecure, they must contain a <code class="docutils literal"><span class="pre">drush</span> <span class="pre">lock</span></code> file to ensure that they
are not overwritten by drush. For installation instructions, see
<a class="reference external" href="%5Bacquia-product:kb%5Darticles/using-drush-lock-files-contributed-modules">Using drush lock files with contributed
modules</a>.</li>
<li>This <code class="docutils literal"><span class="pre">lock</span></code> must exist on the production tag, because this is the
default tag from which all RA Updates begin.</li>
<li>Modules that are locked will not receive security updates. Any
security vulnerability that results is the responsibility of the
Client’s development team.</li>
<li>Modified modules overwritten as a part of the update process can be
reverted. The RA team can assist with installing lock files to
prevent further modifications. At this time, update automation does
not detect differences between the installed module and its official
release on Drupal.org.</li>
</ul>
</div>
<div class="section" id="patching-core-and-contributed-modules">
<span id="patching"></span><h2>Patching core and contributed modules<a class="headerlink" href="#patching-core-and-contributed-modules" title="Permalink to this headline">¶</a></h2>
<p>Acquia RA supports patches to core and contributed modules at its
discretion. To provide support, patch information and files must be
provided and correctly set up. Update automation will attempt to apply
the provided patches, and all results will be noted in the corresponding
ticket.</p>
<p>Update automation implements a slightly modified version of the <a class="reference external" href="https://bitbucket.org/davereid/drush-patchfile">Drush
Patch File</a>
extension. The following steps detail examples of each different use
case.</p>
<ol class="arabic">
<li><p class="first">Create the <code class="docutils literal"><span class="pre">patches.make</span></code> file in the following location:</p>
<p><code class="docutils literal"><span class="pre">[reponame]/</span></code></p>
</li>
<li><p class="first">Ensure that the <code class="docutils literal"><span class="pre">patches.make</span></code> file contains the following
information for the patch:</p>
<ul class="simple">
<li>A link to the patch, either on
<a class="reference external" href="https://www.drupal.org">Drupal.org</a> (preferred) or in the repo</li>
<li>If the patch exists only in the repo, place it in
<code class="docutils literal"><span class="pre">[reponame]/patches/my_custom_patch.patch</span></code>, as patches placed in
the directory of the module they modify will be overwritten before
automation attempts to apply the patch, and the patch will be
unavailable</li>
<li>A comment linking to the original Drupal.org issue which the patch
addresses</li>
<li>A comment noting anything special about the applicability of this
particular patch</li>
</ul>
</li>
<li><p class="first">Repeat the previous step for each discrete patch.</p>
<p>Note</p>
<p>It is also possible to combine all patches into a single patch file.
However, this method makes it more difficult to discern which part of
the patch is still relevant.</p>
</li>
</ol>
<p>A complete <code class="docutils literal"><span class="pre">patches.make</span></code> file with a Drupal core patch, a remote
patch file from Drupal.org, and a local patch would look similar to
this:</p>
<p><code class="docutils literal"><span class="pre">;</span> <span class="pre">Specify</span> <span class="pre">the</span> <span class="pre">version</span> <span class="pre">of</span> <span class="pre">Drupal</span> <span class="pre">being</span> <span class="pre">used.</span> <span class="pre">core</span> <span class="pre">=</span> <span class="pre">7.x</span> <span class="pre">;</span> <span class="pre">Specify</span> <span class="pre">the</span> <span class="pre">api</span> <span class="pre">version</span> <span class="pre">of</span> <span class="pre">Drush</span> <span class="pre">Make.</span> <span class="pre">api</span> <span class="pre">=</span> <span class="pre">2</span>&#160; <span class="pre">;</span> <span class="pre">N/A</span> <span class="pre">;</span> <span class="pre">Patching</span> <span class="pre">README.txt</span> <span class="pre">file.</span> <span class="pre">projects[drupal][patch][]</span> <span class="pre">=</span> <span class="pre">&quot;patches/minor_core_patch.patch&quot;</span>&#160; <span class="pre">;</span> <span class="pre">https://www.drupal.org/node/2408217</span> <span class="pre">;</span> <span class="pre">Error</span> <span class="pre">when</span> <span class="pre">attempting</span> <span class="pre">to</span> <span class="pre">clear</span> <span class="pre">cache</span> <span class="pre">that</span> <span class="pre">is</span> <span class="pre">related</span> <span class="pre">to</span> <span class="pre">ctools.</span> <span class="pre">projects[ctools][patch][]</span> <span class="pre">=</span> <span class="pre">&quot;https://www.drupal.org/files/issues/ctools-cache-handler.patch&quot;</span>&#160; <span class="pre">;</span> <span class="pre">https://www.drupal.org/node/1713076</span> <span class="pre">;</span> <span class="pre">Devel</span> <span class="pre">generate</span> <span class="pre">fails</span> <span class="pre">when</span> <span class="pre">generating</span> <span class="pre">data</span> <span class="pre">for</span> <span class="pre">a</span> <span class="pre">field.</span> <span class="pre">projects[devel][patch][]</span> <span class="pre">=</span> <span class="pre">&quot;patches/devel_generate_textfield_maxlength-1713076-1.patch&quot;</span></code></p>
<p>Note</p>
<p>Acquia recommends placing local patch files in a directory called
<code class="docutils literal"><span class="pre">patches</span></code>, which is located above the <code class="docutils literal"><span class="pre">docroot</span></code> directory.</p>
<p>Automated patching is still being tested, and functionality improvements
will be added. It is imperative that all functionality affected by the
patch be thoroughly tested to ensure it behaves as expected. While the
RA team can help troubleshoot such functionality, all customizations are
ultimately the responsibility of the Client’s development team.</p>
<p>Acquia RA recommends moving to stable, unmodified module releases as
soon as possible. We recommend that development teams regularly check to
see if a patched issue was resolved in either a security update or
bug-fix release in order to move from modified code to a clean release.</p>
</div>
</div>


        
    </div>
</div>

    
<div class="row">
    <div class="small-4 large-3 columns"></div>
    <div id="relinks" class="small-8 large-9 columns">
        <div class="pagination-wrapper">
            <div class="prev">
                <a href="security-update-process.html" title="Security update process"><b>‹&nbsp;</b>Security update process</a>
            </div>
            
            <div class="next">
                <a href="faq.html" title="Remote Administration FAQ">Remote Administration FAQ<b>&nbsp;›</b></a>
            </div>
            
        </div>
    </div>
</div>



    
<div class="assistance-wrapper">
	<div class="assistance-tbl">
		<div class="col">
			<p><img src="/_static/phone.png" alt="Contact support">Still need assistance? <strong><a href="https://docs.acquia.com/support">Contact Acquia Support</a></strong></p>
		</div>
	</div>
</div>
<div class="support">
	<div class="support-tbl">
		<div class="col left">
			<h2><a href="https://www.acquia.com/customer-success/acquia-global-support">Support</a></h2>
			<ul class="no-bullet">
				<li><a class="light-link" href="https://www.acquia.com/support">Contact Support</a></li>
			</ul>
		</div>
		<div class="col middle">
			<h2><a href="https://www.acquia.com/about-us">About Acquia</a></h2>
			<ul class="no-bullet">
				<li><a class="light-link" href="https://www.acquia.com/about-us">About Us</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/leadership">Leadership</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/board">Board of Directors</a></li>
				<li><a class="light-link" href="https://www.acquia.com/investors">Investors</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/newsroom">Newsroom</a></li>
				<li><a class="light-link" href="https://www.acquia.com/careers">Careers</a></li>
				<li><a class="light-link" href="https://www.acquia.com/about-us/contact">Contact Us</a></li>
			</ul>
			<ul class="social-media">
				<li>
					<a class="fa fa-twitter fa-lg ext" href="https://twitter.com/acquia" target="_blank" rel="nofollow">
						<span class="hide">Twitter</span>
					</a>
				</li>
				<li>
					<a class="fa fa-facebook fa-lg ext" href="https://www.facebook.com/acquia" target="_blank" rel="nofollow">
						<span class="hide">Facebook</span>
					</a>
				</li>
				<li>
					<a class="fa fa-github-alt fa-lg ext" href="https://github.com/acquia" target="_blank" rel="nofollow">
						<span class="hide">Github</span>
					</a>
				</li>
				<li>
					<a class="fa fa-linkedin-in fa-lg ext" href="http://www.linkedin.com/company/167056" target="_blank" rel="nofollow">
						<span class="hide">LinkedIn</span>
					</a>
				</li>
				<li>
					<a class="fa fa-google-plus-g fa-lg ext" href="https://plus.google.com/+acquia" target="_blank" rel="nofollow">
						<span class="hide">Google+</span>
					</a>
				</li>
				<li>
					<a class="fa fa-play fa-lg ext" href="https://www.youtube.com/user/AcquiaTV" target="_blank" rel="nofollow">
						<span class="hide">YouTube</span>
					</a>
				</li>
				<li>
					<a class="fa fa-envelope fa-lg" href="https://www.acquia.com/about-us/contact">
						<span class="hide">Contact Us</span>
					</a>
				</li>
			</ul>
		</div>
		<div class="col right">
			<div class="centered">
				<p>
					<img alt="Acquia: Think Ahead" src="/_static/acquia-logo-think-ahead-black-small.svg">
				</p>
				<p class="margin-left-half">
					<span>53 State Street, 10th Floor<br>
					Boston, MA 02109<br>
					United States<br>
					Phone: 888-922-7842</span><br>
					Map: <a class="decorate ext" href="http://maps.google.com/?q=42.358429+-71.056184+%2853+State+Street%2C+10th+Floor%2C+Boston%2C+MA%2C+02109%2C+us%29" target="_blank" rel="nofollow">Google Maps<span class="ext"><span class="element-invisible"> </span></span></a><br><a class="decorate" href="https://www.acquia.com/about-us/contact#block-views-locations-block-1">View other locations</a>
				</p>
			</div>
		</div>
	</div>
</div>
<div class="top-bar row column">
	<div class="footer" role="contentinfo">Copyright &copy 2018 Acquia Inc. All Rights Reserved. </br>Drupal is a registered trademark of <a href="https://dri.es/">Dries Buytaert</a>. All product names, logos, and brands are property of their respective owners.
    </div>
</div>
    </div>

    <script> $(document).foundation() </script>
    <script type="text/javascript">
      (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
      (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
      e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
      })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

      _st('install','2_Wi1aQvEeu61haxG8TX','2.0.0');
    </script>

  </body>
</html>